<!DOCTYPE html>
<html lang="english">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="charset" content="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Awaitable | Sleep</title>
    <link rel="apple-touch-icon"      sizes="57x57"   href="/resources/awaitable/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon"      sizes="60x60"   href="/resources/awaitable/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon"      sizes="72x72"   href="/resources/awaitable/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon"      sizes="76x76"   href="/resources/awaitable/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon"      sizes="114x114" href="/resources/awaitable/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon"      sizes="120x120" href="/resources/awaitable/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon"      sizes="144x144" href="/resources/awaitable/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon"      sizes="152x152" href="/resources/awaitable/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon"      sizes="180x180" href="/resources/awaitable/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/resources/awaitable/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32"   href="/resources/awaitable/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96"   href="/resources/awaitable/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16"   href="/resources/awaitable/icons/favicon-16x16.png">
    <link rel="icon" type="image/x-icon"              href="/resources/awaitable/icons/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon"     href="/resources/awaitable/icons/favicon.ico">

    <link type="text/css" rel="stylesheet" href="/theme/css/libs.css">
    <link type="text/css" rel="stylesheet" href="/theme/css/style.css">
    <link type="text/css" rel="stylesheet" href="/theme/css/stylesheet.css">
    <link type="text/css" rel="stylesheet" href="/theme/css/sidebar.css">
    <link type="text/css" rel="stylesheet" href="/theme/css/blockquotes.css">
    <link type="text/css" rel="stylesheet" href="/theme/css/blockquotes-english.css">
    <link type="text/css" rel="stylesheet" href="/theme/css/external-links.css">







    <link type="font/woff2" rel="preload" href="/theme/fonts/istok-web-v15-latin/istok-web-v15-latin-regular.woff2" as="font" crossorigin>
    <link type="font/woff2" rel="preload" href="/theme/fonts/istok-web-v15-latin/istok-web-v15-latin-700.woff2" as="font" crossorigin>
    <link type="font/woff2" rel="preload" href="/theme/fonts/montserrat-v15-latin/montserrat-v15-latin-700.woff2" as="font" crossorigin>
    <link type="font/woff2" rel="preload" href="/theme/fonts/montserrat-v15-latin/montserrat-v15-latin-600.woff2" as="font" crossorigin>
    <link type="font/woff2" rel="preload" href="/theme/fonts/material-icons/material-icons.woff2" as="font" crossorigin>
    <link type="font/woff2" rel="preload" href="/theme/fonts/material-icons/material-icons-outlined.woff2" as="font" crossorigin>
    <script type="text/javascript" src="/theme/js/jquery-1.10.2.min.js"></script>

  </head>
  <body>
    <main class="main">
      <div class="main-inner">
        <div class="bff d-md-block">
          <div class="container">
            <div class="row">
              <div class="col">
                <div class="bff-container">
                  <a class="main-logo" href="/awaitable/english/">
                    <img src="/resources/awaitable/icons/ms-icon-144x144.png"></a>
                  <div class="main-title">
                    <h1><a href="/awaitable/english/">
                      <span class="middle">Awaitable</span></a></h1>
                    <h2>Sleep</h2>
                  </div>
                  <div class="float-right gitrepo">
                    <a href="https://github.com/muflone/awaitable" target="_blank" class="button">
                      <small>View project on</small>
                      GitHub
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="container content" id="content">
                  <section id="main-content">
<h1 id="sleep">Sleep</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">import</span> <span class="nn">awaitable</span>


<span class="o">@</span><span class="n">awaitable</span><span class="p">.</span><span class="n">awaitable</span>
<span class="k">def</span> <span class="nf">do_process</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
               <span class="n">t</span><span class="p">:</span> <span class="n">typing</span><span class="p">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="s">"""
    Await some time before returning
    :param name: task name
    :param t: time to sleep in seconds
    :return: None
    """</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'From </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: awaiting </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s"> seconds...'</span><span class="p">)</span>
    <span class="n">starting_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'From </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: task complete '</span>
                 <span class="sa">f</span><span class="s">'in </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">starting_time</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds'</span><span class="p">)</span>
</code></pre></div></div>

<p>The <strong><code class="language-plaintext highlighter-rouge">do_process</code></strong> function is marked as awaitable and it will simply log a
descriptive text and sleep an amount of seconds as passed from the argument
<strong><code class="language-plaintext highlighter-rouge">t</code></strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="s">"""
    Run some processes asynchronously
    Each process will await a random number of seconds

    :param count: number of tasks to process
    :return: None
    """</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'Running </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s"> processes'</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">awaitable</span><span class="p">.</span><span class="n">AsyncioGather</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
        <span class="n">tasks</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">do_process</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">'task_</span><span class="si">{</span><span class="n">tasks</span><span class="p">.</span><span class="n">count</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s">'</span><span class="p">,</span>
                             <span class="n">t</span><span class="o">=</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">)))</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'Starting to process </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span><span class="si">}</span><span class="s"> tasks'</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">tasks</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></div>

<p>The <strong><code class="language-plaintext highlighter-rouge">process</code></strong> function is an asynchronous function which will gather a number
of processes before processing them at once in asynchronous way.</p>

<p>As the result, all the sleep (see the <strong><code class="language-plaintext highlighter-rouge">do_process</code></strong> function) calls will be
executed more or less at the same time and the whole process will be completed
when the longest sleep will be completed.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s">'%(levelname)-8s '</span>
                               <span class="s">'%(filename)-15s '</span>
                               <span class="s">'line: %(lineno)-5d '</span>
                               <span class="s">'%(funcName)-20s '</span>
                               <span class="s">'%(message)s'</span><span class="p">)</span>
    <span class="n">starting_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">awaitable</span><span class="p">.</span><span class="n">run_awaitable</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">process</span><span class="p">,</span>
                            <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ending_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'Operation completed in </span><span class="si">{</span><span class="n">ending_time</span> <span class="o">-</span> <span class="n">starting_time</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> '</span>
                 <span class="s">'seconds'</span><span class="p">)</span>
</code></pre></div></div>

<p>The function call <strong><code class="language-plaintext highlighter-rouge">run_awaitable</code></strong> will execute the asynchronous function
<strong><code class="language-plaintext highlighter-rouge">process</code></strong> passing the number of parallel workers 10 to process.</p>

<p>At the end the elapsed seconds needed to complete the operation will be
printed.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO     01_sleep.py     line: 53    process              Running 10 processes
INFO     01_sleep.py     line: 58    process              Starting to process 10 tasks
INFO     01_sleep.py     line: 38    do_process           From task_1: awaiting 10 seconds...
INFO     01_sleep.py     line: 38    do_process           From task_2: awaiting 0 seconds...
INFO     01_sleep.py     line: 41    do_process           From task_2: task complete in 0.00 seconds
INFO     01_sleep.py     line: 38    do_process           From task_3: awaiting 2 seconds...
INFO     01_sleep.py     line: 38    do_process           From task_4: awaiting 9 seconds...
INFO     01_sleep.py     line: 38    do_process           From task_5: awaiting 7 seconds...
INFO     01_sleep.py     line: 38    do_process           From task_6: awaiting 10 seconds...
INFO     01_sleep.py     line: 38    do_process           From task_7: awaiting 5 seconds...
INFO     01_sleep.py     line: 38    do_process           From task_8: awaiting 5 seconds...
INFO     01_sleep.py     line: 38    do_process           From task_9: awaiting 8 seconds...
INFO     01_sleep.py     line: 38    do_process           From task_10: awaiting 0 seconds...
INFO     01_sleep.py     line: 41    do_process           From task_10: task complete in 0.00 seconds
INFO     01_sleep.py     line: 41    do_process           From task_3: task complete in 2.00 seconds
INFO     01_sleep.py     line: 41    do_process           From task_8: task complete in 5.00 seconds
INFO     01_sleep.py     line: 41    do_process           From task_7: task complete in 5.00 seconds
INFO     01_sleep.py     line: 41    do_process           From task_5: task complete in 7.01 seconds
INFO     01_sleep.py     line: 41    do_process           From task_9: task complete in 8.01 seconds
INFO     01_sleep.py     line: 41    do_process           From task_4: task complete in 9.01 seconds
INFO     01_sleep.py     line: 41    do_process           From task_1: task complete in 10.01 seconds
INFO     01_sleep.py     line: 41    do_process           From task_6: task complete in 10.01 seconds
INFO     01_sleep.py     line: 74    &lt;module&gt;             Operation completed in 10.02 seconds
</code></pre></div></div>

<p>It will execute 10 jobs with a random sleep from 0 to 10 seconds and the whole
operation will be completed in about 10.02 seconds. Without using async or
awaitable the synchronous operation would have needed about 56 seconds.</p>

        </section>
        <aside id="sidebar" class="content">
          <!-- Build sidebar depth 1 -->
          <ul class="menu1">
            <li class="menu1"><a href="/awaitable/english/index.html">Introduction</a></li>
            <li class="menu1"><a href="/awaitable/english/download.html">Download</a></li>
            <li class="menu1"><a href="/awaitable/english/install.html">Installation</a></li>
            <li class="menu1"><a href="/awaitable/english/docs/index.html">Documentation</a></li>
            
            <!-- Begin of sidebar depth 2 -->
            <ul class="menu2">
          
              <li class="menu2"><a href="/awaitable/english/docs/awaitable.html">awaitable</a></li>
              <li class="menu2"><a href="/awaitable/english/docs/run_awaitable.html">run_awaitable</a></li>
              <li class="menu2"><a href="/awaitable/english/docs/asynciogather.html">AsyncioGather</a></li>
            </ul>
            <!-- End of sidebar depth 2 -->
          
            <li class="menu1"><a href="/awaitable/english/examples/index.html">Usage examples</a></li>
            
            <!-- Begin of sidebar depth 2 -->
            <ul class="menu2">
          
              <li class="menu2"><a href="/awaitable/english/examples/sleep.html">Sleep</a></li>
            </ul>
            <!-- End of sidebar depth 2 -->
          
            <li class="menu1"><a href="/awaitable/english/changelog.html">Changelog</a></li>
          </ul>
          <!-- End of sidebar depth 1 -->

        </aside>
        </div>
      </div>

      <!-- Begin footer -->
      <footer class="footer">
        <div class="footer-main row">
          <div class="container footer-icons">
            <a href="/" title="Home">
              <img src="/resources/home/icons/apple-icon-60x60.png">
            </a>

            <a href="/contacts/" title="Muflone">
              <img src="/resources/contacts/icons/apple-icon-60x60.png">
            </a>

            <a href="/articles/" title="Articles">
              <img src="/resources/articles/icons/apple-icon-60x60.png">
            </a>

            <a href="/gespeaker/" title="Gespeaker">
              <img src="/resources/gespeaker/icons/apple-icon-60x60.png">
            </a>

            <a href="/gwakeonlan/" title="gWakeOnLAN">
              <img src="/resources/gwakeonlan/icons/apple-icon-60x60.png">
            </a>

            <a href="/gextractwinicons/" title="gExtractWinIcons">
              <img src="/resources/gextractwinicons/icons/apple-icon-60x60.png">
            </a>

            <a href="/bluewho/" title="BlueWho">
              <img src="/resources/bluewho/icons/apple-icon-60x60.png">
            </a>

            <a href="/cpucompare/" title="CPUCompare">
              <img src="/resources/cpucompare/icons/apple-icon-60x60.png">
            </a>

            <a href="/gptrace/" title="gpTrace">
              <img src="/resources/gptrace/icons/apple-icon-60x60.png">
            </a>

            <a href="/gnome-appfolders-manager/" title="GNOME AppFolders Manager">
              <img src="/resources/gnome-appfolders-manager/icons/apple-icon-60x60.png">
            </a>

            <a href="/gtransmemory/" title="gTransMemory">
              <img src="/resources/gtransmemory/icons/apple-icon-60x60.png">
            </a>

            <a href="/remmina-plugin-builder/" title="Remmina Plugin Builder">
              <img src="/resources/remmina-plugin-builder/icons/apple-icon-60x60.png">
            </a>

            <a href="/remmina-plugin-exec/" title="Remmina Plugin Exec">
              <img src="/resources/remmina-plugin-exec/icons/apple-icon-60x60.png">
            </a>

            <a href="/remmina-plugin-folder/" title="Remmina Plugin Folder">
              <img src="/resources/remmina-plugin-folder/icons/apple-icon-60x60.png">
            </a>

            <a href="/remmina-plugin-open/" title="Remmina Plugin Open">
              <img src="/resources/remmina-plugin-open/icons/apple-icon-60x60.png">
            </a>

            <a href="/remmina-plugin-rdesktop/" title="Remmina Plugin RDesktop">
              <img src="/resources/remmina-plugin-rdesktop/icons/apple-icon-60x60.png">
            </a>

            <a href="/remmina-plugin-teamviewer/" title="Remmina Plugin TeamViewer">
              <img src="/resources/remmina-plugin-teamviewer/icons/apple-icon-60x60.png">
            </a>

            <a href="/remmina-plugin-ultravnc/" title="Remmina Plugin UltraVNC">
              <img src="/resources/remmina-plugin-ultravnc/icons/apple-icon-60x60.png">
            </a>

            <a href="/remmina-plugin-url/" title="Remmina Plugin URL">
              <img src="/resources/remmina-plugin-url/icons/apple-icon-60x60.png">
            </a>

            <a href="/remmina-plugin-webkit/" title="Remmina Plugin WebKit">
              <img src="/resources/remmina-plugin-webkit/icons/apple-icon-60x60.png">
            </a>

            <a href="/awaitable/" title="Awaitable">
              <img src="/resources/awaitable/icons/apple-icon-60x60.png">
            </a>

            </div>
        </div>
        <div class="footer-bottom row">
          <div class="container">
            <div class="row justify-content-between items">
              <div class="col-md-auto col-12 item">
                <nav class="footer-links">
                  <ul>
                    <li><a href="/">Home</a></li>
                      <li><a href="/contacts/" title="Contacts">
                          Contacts</a></li>
                    <li><a href="/english/" title="English">
                        <img src="/theme/images/flag-en-16.png"> English</a></li>
                    <li><a href="/italian/" title="Italian">
                        <img src="/theme/images/flag-it-16.png"> Italian</a></li>
                    <li><a href="//www.iubenda.com/privacy-policy/721463" target="_blank">
                      Privacy Policy</a></li>
                  </ul>
                </nav>
              </div>
              <div class="col-md-auto col-12 item">
                <div class="copyright">
                  Last update: 2022-11-20 -
                  Copyright &copy; 2013-2022 Fabio Castelli (Muflone)
                </div>
              </div>
            </div>
          </div>
        </div>
      </footer>
      <!-- End footer -->
    </main>
    <!-- End main -->

    <script type="text/javascript" src="/theme/js/lozad.min.js"></script>
    <script type="text/javascript" src="/theme/js/device.js"></script>
    <script type="text/javascript" src="/theme/js/custom.js"></script>


    <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
    <script type="text/javascript">
        window.cookieconsent_options = {'message': 'This website uses cookies to make your browsing experience more convenient and personal. Cookies store useful information on your computer to help us improve the efficiency and relevance of our site for you. In some cases, they are essential to making the site work properly. By accessing this site, you consent to the use of cookies.',
                                        'dismiss': 'Hide',
                                        'learnMore': 'More info',
                                        'link': 'https://www.iubenda.com/privacy-policy/721463',
                                        'theme': 'dark-top'
                                       };
    </script>
    <script type="text/javascript" src="/theme/js/cookieconsent.js"></script>
    <!-- End Cookie Consent plugin -->
    <!-- Begin of Google Analytics block -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-44039396-3', 'muflone.com');
      ga('send', 'pageview');
    </script>
    <!-- End of Google Analytics block -->
  </body>
</html>